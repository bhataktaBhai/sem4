\chapter{Riemann Integration} \label{chp:riemann}
\section[\R-valued Functions]{Real-valued Functions}
\lecture{2024-03-25}{}
\begin{definition}[Partition] \label{def:partition}
    Let $f\colon [a, b] \to \R$ be a bounded function.
    A \textit{partition} of $[a, b]$ is \[
        P = \set{x_0 \le x_1 \le \cdots \le x_n}
    \] where $x_0 = a$ and $x_n = b$.

    We write \begin{align*}
        \Delta x_j \coloneq \Delta_j &\coloneq x_j - x_{j-1}, \\
        M_j   &\coloneq \sup_{[x_{j-1}, x_j]} f, \\
        m_j   &\coloneq \inf_{[x_{j-1}, x_j]} f, \\
        \mcU(P, f) &\coloneq \sum_{j\coloneq1}^n M_j \Delta x_j, \\
        \mcL(P, f) &\coloneq \sum_{j\coloneq1}^n m_j \Delta x_j.
    \end{align*}
\end{definition}

\begin{definition*}[Riemann integration] \label{def:riemann}
    We use these to define \begin{align*}
        \wbar{\int_a^b} f(x) \dd x
        &= \inf \set{\mcU(P, f) \mid P \text{ is a partition of } [a, b]}, \\
        \ubar{\int_a^b} f(x) \dd x
        &= \sup \set{\mcL(P, f) \mid P \text{ is a partition of } [a, b]}.
    \end{align*}
    If $\wbar{\int_a^b} f(x) \dd x = \ubar{\int_a^b} f(x) \dd x = L$,
    we say that $f$ is \textit{Riemann integrable} on $[a, b]$ and that \[
        \int_a^b f(x) \dd x = L.
    \] We denote the family of Riemann integrable functions on $[a, b]$ by
    $\mcR([a, b])$.
\end{definition*}

\begin{lemma} \label{thm:refinement}
    Let $P^*$ be a \emph{refinement} of $P$, \ie,
    $P^*$ partitions $[a, b]$ and $P \subseteq P^*$. Then \begin{align*}
        \mcL(P, f) &\le \mcL(P^*, f), \\
        \mcU(P^*, f) &\le \mcU(P, f).
    \end{align*}
\end{lemma}
\begin{proof}
    Induct on $\abs{P^* \setminus P}$.
    Trivial for $\abs{P^* \setminus P} = 0$.

    Suppose the result holds for $\abs{P^* \setminus P} = n$.
    Let $P^\star$ be a refinement of $P$ with
    $\abs{P^\star \setminus P} = n + 1$.
    Let $P^* = P^\star \setminus \set{y}$,
    for some $y \in P^\star \setminus P$.
    Then $P^\star$ is a refinement of $P^*$ with just one extra point.

    Let \[
        P^\star = \set{x_0 \le x_1 \le \dots
            \le x_k \le y \le x_{k+1} \le
            \dots \le x_m}.
    \] Then \begin{align*}
        \mcL(P^\star, f) - \mcL(P^*, f)
            &= (y - x_k) \smashoperator{\inf_{[x_k, y]}} f
                + (x_{k+1} - y) \smashoperator{\inf_{[y, x_{k+1}]}} f
                - (x_{k+1} - x) \smashoperator{\inf_{[x_k, x_{k+1}]}} f \\
            &\ge (y - x_k) \smashoperator{\inf_{[x_k, x_{k+1}]}} f
                + (x_{k+1} - y) \smashoperator{\inf_{[x_k, x_{k+1}]}} f
                - (x_{k+1} - x) \smashoperator{\inf_{[x_k, x_{k+1}]}} f \\
            &= 0.
    \end{align*}
    Similarly, $\mcU(P^\star, f) - \mcU(P^*, f) \le 0$.
    Thus \begin{align*}
        \mcL(P, f) \le \mcL(P^*, f) \le \mcL(P^\star, f) \\
        \mcU(P, f) \ge \mcU(P^*, f) \ge \mcU(P^\star, f).
    \end{align*}
    Winduction.
\end{proof}

\begin{lemma*}
    Let $P_1$ and $P_2$ be partitions of $[a, b]$.
    Then \[
        \mcL(P_1, f) \le \mcU(P_2, f).
    \]
\end{lemma*}
\begin{proof}
    Let $P^* = P_1 \cup P_2$, which refines both.
    Then \[
        \mcL(P_1, f) \le \mcL(P^*, f) \le \mcU(P^*, f) \le \mcU(P_2, f).
        \qedhere
    \]
\end{proof}

\begin{corollary}
    $\ubar{\int_a^b} f(x) \dd x$ and $\wbar{\int_a^b} f(x) \dd x$
    are well-defined in \R, and \[
        \ubar{\int_a^b} f(x) \dd x \le \wbar{\int_a^b} f(x) \dd x.
    \]
\end{corollary}

\begin{theorem*}
    $f$ is Riemann integrable on $[a, b]$ iff for every $\varepsilon > 0$,
    there exists a partition $P_\varepsilon$ of $[a, b]$ such that \[
        \mcU(P_\varepsilon, f) - \mcL(P_\varepsilon, f) < \varepsilon.
    \]
\end{theorem*}
\begin{proof}
    For the ``if'' direction, let $\varepsilon > 0$.
    Then $\mcU(P_\varepsilon, f) - \mcL(P_\varepsilon, f) < \varepsilon$.
    So $\inf_P \mcU(P, f) - \sup_P \mcL(P, f) < \varepsilon$.
    Since this is true for all $\varepsilon > 0$, we have that they are
    equal.

    For the ``only if'' direction, let $\varepsilon > 0$.
    There exists a partition $P$ such that \[
        \wbar{\int_a^b} f(x) \dd x
            \le \mcU(P, f)
            < \wbar{\int_a^b} f(x) \dd x + \frac{\varepsilon}{2}.
    \] Similarly, there exists a partition $P'$ such that \[
        \ubar{\int_a^b} f(x) \dd x
            \ge \mcL(P', f)
            > \ubar{\int_a^b} f(x) \dd x - \frac{\varepsilon}{2}.
    \] But $\wbar{\int_a^b} f(x) \dd x = \ubar{\int_a^b} f(x) \dd x$!
    So both $\mcU(P, f)$ and $\mcL(P', f)$ are within $\varepsilon/2$ of
    $\int_a^b f(x) \dd x$.

    Let $P^*$ be their common refinement.
    Then \[
        \mcU(P^*, f) - \mcL(P^*, f)
            \le \mcU(P, f) - \mcL(P', f)
            < \varepsilon. \qedhere
    \]
\end{proof}

\begin{remarks}
    \item $\mcU(P_\varepsilon, f) - \mcL(P_\varepsilon, f) < \varepsilon$
    continues to hold for any refinement of $P_\varepsilon$.
    \item Suppose $\mcU - \mcL < \varepsilon$ holds for $P_\varepsilon$,
    and $s_j, t_j \in [x_{j-1}, x_j] \;\forall j \in [n]$.
    Then \[
        \sum_{j=1}^n \abs{f(s_j) - f(t_j)} \Delta x_j
            \le \mcU - \mcL
            < \varepsilon.
    \]
    \item Suppose $f$ is Riemann integrable and $\mcU - \mcL < \varepsilon$
    holds.
    Then for any $t_j \in [x_{j-1}, x_j]$, \[
        \abs{\int_a^b f(x) \dd x - \sum_{j=1}^n f(t_j) \Delta x_j}
            < \varepsilon.
    \]
\end{remarks}

\begin{exercise}
    Every monotone function on $[a, b]$ is Riemann integrable.
\end{exercise}
\begin{proof}
    WLOG suppose that $f\colon [a, b] \to \R$ is increasing.
    First note that $f$ is bounded, specifically by $f(a)$ below and
    $f(b)$ above.
\end{proof}

\begin{theorem*}
    Let $f \in \mcR[a, b]$ with $f[a, b] \subseteq [m, M]$, and
    let $\phi\colon [m, M] \to \R$ be a continuous function.
    Then \[
        \phi \circ f \in \mcR[a, b].
    \]
\end{theorem*}
\begin{proof}
    Let $\phi([m, M]) = [\wbar{m}, \wbar{M}]$.
    Let $\varepsilon > 0$.
\end{proof}
